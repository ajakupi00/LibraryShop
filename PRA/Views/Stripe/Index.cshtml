
@{
    ViewBag.Title = "Index";
    string clientSecret = ViewBag.clientSecret as string;
    string called = ViewBag.called as string;
    WebApplication1.Models.Book book = ViewBag.book as WebApplication1.Models.Book;
}

<style>
    #card-element {
        border-radius: 4px 4px 0 0;
        padding: 12px;
        border: 1px solid rgba(50, 50, 93, 0.1);
        height: 44px;
        width: 400px;
        background: white;
    }

    #btnPay {
        background: #5469d4;
        color: #ffffff;
        font-family: Arial, sans-serif;
        border-radius: 0 0 4px 4px;
        border: 0;
        padding: 12px 16px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        display: block;
        transition: all 0.2s ease;
        box-shadow: 0px 4px 5.5px 0px rgba(0, 0, 0, 0.07);
        width: 100%;
    }

        #btnPay:hover {
            filter: contrast(115%);
        }

        #btnPay:disabled {
            opacity: 0.5;
            cursor: default;
        }
    }
</style>


<div class="d-flex align-items-center justify-content-center flex-column my-5" style="width: 50vw; height: 30vw; box-shadow: inset 0 0 75px 50px rgba(0, 0, 0, 0.1); margin-inline: auto ">
    <h1 class="p-5 fw-bold" style="color: #5469d4;">Pay with Stripe @called</h1>
    @using (Html.BeginForm("Index", "Stripe", new { called = "succces", title = book.Title }, FormMethod.Post, new { @id = "payment-form", @class  = "mw-100"}))
    {
        <label class="form-label">Card owner:</label>
        <input type="text" class="form-control mb-3 mw-100" id="name" placeholder="Enter the card owner name..." />
        <div id="card-element" class="mw-100">

        </div>
        <button id="btnPay" type="submit">Pay</button>
    }
</div>



<script>
    document.addEventListener("DOMContentLoaded", function () {
     
        var stripe = Stripe("pk_test_51LFsR2ICrnxhV7iWYaeIjmMleqRe2xcfh3xtGe4epqF8kD32qbeqOJ9YdrljrUgFd2gxjsmLdkXqbb5SxEemBbLr00UqfuprPH");
        var elements = stripe.elements();
        var cardElement = elements.create('card');
        cardElement.mount('#card-element');

        var nameInput = document.getElementById('#name');

        var form = document.getElementById('payment-form');


       form.addEventListener("submit", function(e) {
         e.preventDefault();
         // Tokenize payment details and confirm the payment intent.
           stripe.confirmCardPayment(
           "@clientSecret",
           {
             payment_method: {
               card: cardElement,
               billing_details: {
                   name: name.value,
               }
             }
           }
         ).then(function(result) {
             if (result.error) {
                 console.log("error");
             alert(result.error.message);
           } else {
             console.log("successful payment!");
             form.submit();
           }
         })
       });
    });

   

</script>

